import { SeasonalDisease } from '../models/seasonalDiseaseModel.js';

const useMemory = String(process.env.SKIP_DB).toLowerCase() === 'true';
const memoryDiseases = [
  {
    _id: '1',
    name: 'ডেঙ্গু',
    season: 'বর্ষা',
    symptoms: ['জ্বর', 'মাথাব্যথা', 'পেশিতে ব্যথা', 'চামড়ায় র্যাশ'],
    details: 'ডেঙ্গু একটি মশাবাহিত রোগ যা বর্ষাকালে বেশি দেখা যায়। এডিস মশা এর বাহক।',
    prevention: ['মশারি ব্যবহার করুন', 'পানি জমতে দেবেন না', 'পরিষ্কার-পরিচ্ছন্ন থাকুন'],
    treatment: 'পর্যাপ্ত পানি পান করুন, বিশ্রাম নিন এবং ডাক্তারের পরামর্শ নিন। প্যারাসিটামল নিতে পারেন তবে অ্যাসপিরিন এড়িয়ে চলুন।',
    solution: 'ডেঙ্গু হলে প্রথমে জ্বর কমানোর জন্য প্যারাসিটামল নিন। প্রচুর পানি এবং তরল খাবার খান। যদি জ্বর বেশি হয় বা রক্তক্ষরণের লক্ষণ দেখা যায়, তবে তাড়াতাড়ি হাসপাতালে যান।',
    tips: ['মশারি ব্যবহার করে ঘুমান', 'বাড়ির চারপাশে পানি জমতে দেবেন না', 'মশার নিরোধক ক্রিম ব্যবহার করুন', 'জ্বর হলে অ্যাসপিরিন এড়িয়ে চলুন'],
    severity: 'তীব্র',
    createdAt: new Date().toISOString()
  },
  {
    _id: '2',
    name: 'সর্দি-কাশি',
    season: 'শীত',
    symptoms: ['নাক দিয়ে পানি পড়া', 'কাশি', 'গলাব্যথা', 'হালকা জ্বর'],
    details: 'শীতকালে ঠান্ডা আবহাওয়ার কারণে সর্দি-কাশি বেশি দেখা যায়।',
    prevention: ['গরম পানি পান করুন', 'গরম কাপড় পরুন', 'পর্যাপ্ত বিশ্রাম নিন'],
    treatment: 'ভিটামিন সি খান, গরম পানি পান করুন, গরম ভাপ নিন। সাধারণত ৭-১০ দিনে সেরে যায়।',
    solution: 'সর্দি-কাশি হলে পর্যাপ্ত বিশ্রাম নিন। গরম পানিতে লেবু ও মধু মিশিয়ে খান। গরম ভাপ নিন এবং নাকের জন্য নাসাল স্প্রে ব্যবহার করতে পারেন।',
    tips: ['গরম কাপড় পরুন', 'পর্যাপ্ত পানি পান করুন', 'ভিটামিন সি সমৃদ্ধ খাবার খান', 'অন্যের সাথে কাছাকাছি থাকবেন না'],
    severity: 'হালকা',
    createdAt: new Date().toISOString()
  },
  {
    _id: '3',
    name: 'হিট স্ট্রোক',
    season: 'গ্রীষ্ম',
    symptoms: ['তীব্র মাথাব্যথা', 'বমি', 'দুর্বলতা', 'ত্বক লাল হয়ে যাওয়া'],
    details: 'গ্রীষ্মকালে অতিরিক্ত গরমে শরীরে পানির ঘাটতি হলে হিট স্ট্রোক হতে পারে।',
    prevention: ['পর্যাপ্ত পানি পান করুন', 'সরাসরি সূর্যের আলো এড়িয়ে চলুন', 'হালকা রঙের কাপড় পরুন'],
    treatment: 'ঠান্ডা জায়গায় যান, ঠান্ডা পানি পান করুন, শরীরে ঠান্ডা পানি ঢালুন। জরুরি অবস্থায় ডাক্তারের কাছে যান।',
    solution: 'হিট স্ট্রোক হলে প্রথমে ঠান্ডা জায়গায় যান। শরীরে ঠান্ডা পানি ঢালুন বা ঠান্ডা কাপড় দিয়ে শরীর মুছে দিন। প্রচুর পানি পান করুন। যদি অবস্থা গুরুতর হয়, তবে হাসপাতালে যান।',
    tips: ['দুপুর ১১টা থেকে ৩টার মধ্যে বাইরে যাবেন না', 'হালকা রঙের ঢিলেঢালা কাপড় পরুন', 'হ্যাট বা ছাতা ব্যবহার করুন', 'প্রচুর পানি পান করুন'],
    severity: 'তীব্র',
    createdAt: new Date().toISOString()
  },
  {
    _id: '4',
    name: 'ডায়রিয়া',
    season: 'সবসময়',
    symptoms: ['পাতলা পায়খানা', 'পেটে ব্যথা', 'পানিশূন্যতা', 'দুর্বলতা'],
    details: 'দূষিত পানি বা খাবার খাওয়ার কারণে ডায়রিয়া হতে পারে।',
    prevention: ['পরিষ্কার পানি পান করুন', 'হাত ধোয়া অভ্যাস করুন', 'তাজা খাবার খান'],
    treatment: 'ওআরএস (ORS) পান করুন, বিশ্রাম নিন, তরল খাবার খান। যদি ২৪ ঘন্টার বেশি হয় তবে ডাক্তারের কাছে যান।',
    solution: 'ডায়রিয়া হলে প্রথমে ওআরএস (ORS) পান করুন। তরল খাবার যেমন ডালের পানি, স্যুপ খান। চর্বিযুক্ত খাবার এড়িয়ে চলুন। যদি ২৪ ঘন্টার বেশি হয় বা রক্ত দেখা যায়, তবে ডাক্তারের কাছে যান।',
    tips: ['শুধুমাত্র পরিষ্কার পানি পান করুন', 'খাবার আগে এবং পরে হাত ধুয়ে নিন', 'তাজা রান্না করা খাবার খান', 'ওআরএস সবসময় সাথে রাখুন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '5',
    name: 'চিকুনগুনিয়া',
    season: 'বর্ষা',
    symptoms: ['জ্বর', 'গাঁটে ব্যথা', 'র্যাশ', 'ক্লান্তি'],
    details: 'এডিস মশার কামড়ে চিকুনগুনিয়া হয়। বর্ষাকালে বেশি দেখা যায়।',
    prevention: ['মশারি ব্যবহার করুন', 'মশার প্রজনন স্থান ধ্বংস করুন', 'মশার নিরোধক ব্যবহার করুন'],
    treatment: 'বিশ্রাম নিন, প্যারাসিটামল নিন, প্রচুর পানি পান করুন। গাঁটে ব্যথা থাকলে গরম সেঁক দিন।',
    solution: 'চিকুনগুনিয়া হলে পর্যাপ্ত বিশ্রাম নিন। জ্বরের জন্য প্যারাসিটামল নিন। গাঁটে ব্যথা হলে গরম সেঁক দিন। প্রচুর পানি পান করুন এবং হালকা ব্যায়াম করুন।',
    tips: ['মশারি ব্যবহার করুন', 'বিশ্রাম নিন এবং ভারী কাজ এড়িয়ে চলুন', 'গাঁটে ব্যথা হলে গরম সেঁক দিন', 'পর্যাপ্ত পানি পান করুন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '6',
    name: 'নিউমোনিয়া',
    season: 'শীত',
    symptoms: ['কাশি', 'জ্বর', 'শ্বাসকষ্ট', 'বুকের ব্যথা'],
    details: 'শীতকালে ঠান্ডা লাগলে নিউমোনিয়া হতে পারে, বিশেষ করে শিশু ও বয়স্কদের জন্য বিপজ্জনক।',
    prevention: ['গরম কাপড় পরুন', 'ধূমপান এড়িয়ে চলুন', 'টিকা নিন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, অ্যান্টিবায়োটিক নিতে হতে পারে। পর্যাপ্ত বিশ্রাম নিন এবং প্রচুর পানি পান করুন।',
    solution: 'নিউমোনিয়া হলে তাড়াতাড়ি ডাক্তারের কাছে যান। অ্যান্টিবায়োটিক নিতে হবে। পর্যাপ্ত বিশ্রাম নিন এবং প্রচুর পানি পান করুন। যদি শ্বাসকষ্ট বেশি হয়, তবে হাসপাতালে ভর্তি হতে হতে পারে।',
    tips: ['গরম কাপড় পরুন', 'ধূমপান এড়িয়ে চলুন', 'নিউমোনিয়া টিকা নিন', 'প্রচুর পানি পান করুন'],
    severity: 'তীব্র',
    createdAt: new Date().toISOString()
  },
  {
    _id: '7',
    name: 'ম্যালেরিয়া',
    season: 'বর্ষা',
    symptoms: ['জ্বর', 'ঠান্ডা লাগা', 'কাঁপুনি', 'মাথাব্যথা', 'বমি'],
    details: 'এনোফিলিস মশার কামড়ে ম্যালেরিয়া হয়। বর্ষাকালে বেশি দেখা যায়।',
    prevention: ['মশারি ব্যবহার করুন', 'মশার প্রজনন স্থান ধ্বংস করুন', 'মশার নিরোধক ব্যবহার করুন', 'জলাবদ্ধতা এড়িয়ে চলুন'],
    treatment: 'তাড়াতাড়ি ডাক্তারের কাছে যান। অ্যান্টিম্যালেরিয়াল ওষুধ নিতে হবে। পর্যাপ্ত পানি পান করুন।',
    solution: 'ম্যালেরিয়া হলে প্রথমে ডাক্তারের কাছে যান। রক্ত পরীক্ষা করাতে হবে। অ্যান্টিম্যালেরিয়াল ওষুধ নিতে হবে। পর্যাপ্ত পানি পান করুন এবং বিশ্রাম নিন।',
    tips: ['মশারি ব্যবহার করে ঘুমান', 'মশার নিরোধক ক্রিম ব্যবহার করুন', 'জলাবদ্ধতা এড়িয়ে চলুন', 'জ্বর হলে তাড়াতাড়ি ডাক্তারের কাছে যান'],
    severity: 'তীব্র',
    createdAt: new Date().toISOString()
  },
  {
    _id: '8',
    name: 'হাঁপানি',
    season: 'শীত',
    symptoms: ['শ্বাসকষ্ট', 'কাশি', 'বুকের সংকোচন', 'শ্বাস নিতে কষ্ট'],
    details: 'শীতকালে ঠান্ডা এবং ধুলোয় হাঁপানি বাড়তে পারে।',
    prevention: ['ধুলো এড়িয়ে চলুন', 'গরম কাপড় পরুন', 'ধূমপান এড়িয়ে চলুন', 'নিয়মিত ইনহেলার ব্যবহার করুন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, ইনহেলার ব্যবহার করুন। গরম পানির ভাপ নিন। জরুরি অবস্থায় ডাক্তারের কাছে যান।',
    solution: 'হাঁপানি হলে ইনহেলার সাথে রাখুন। শ্বাসকষ্ট হলে ইনহেলার ব্যবহার করুন। গরম পানির ভাপ নিন। যদি ইনহেলার কাজ না করে, তবে জরুরি ডাক্তারের কাছে যান।',
    tips: ['ইনহেলার সবসময় সাথে রাখুন', 'ধুলো এবং ঠান্ডা এড়িয়ে চলুন', 'ধূমপান এড়িয়ে চলুন', 'নিয়মিত ব্যায়াম করুন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '9',
    name: 'হেপাটাইটিস এ',
    season: 'বর্ষা',
    symptoms: ['জ্বর', 'পেটে ব্যথা', 'পেট ফুলে যাওয়া', 'বমি', 'চোখ এবং প্রস্রাব হলুদ'],
    details: 'দূষিত পানি বা খাবার খাওয়ার কারণে হেপাটাইটিস এ হতে পারে। বর্ষাকালে বেশি দেখা যায়।',
    prevention: ['পরিষ্কার পানি পান করুন', 'হাত ধোয়া অভ্যাস করুন', 'তাজা খাবার খান', 'টিকা নিন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, বিশ্রাম নিন, প্রচুর পানি পান করুন। চর্বিযুক্ত খাবার এড়িয়ে চলুন।',
    solution: 'হেপাটাইটিস এ হলে পর্যাপ্ত বিশ্রাম নিন। প্রচুর পানি পান করুন। হালকা খাবার খান এবং চর্বিযুক্ত খাবার এড়িয়ে চলুন। ডাক্তারের পরামর্শ অনুযায়ী ওষুধ নিন।',
    tips: ['পরিষ্কার পানি পান করুন', 'হাত ধোয়ার অভ্যাস করুন', 'হালকা খাবার খান', 'পর্যাপ্ত বিশ্রাম নিন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '10',
    name: 'সানবার্ন',
    season: 'গ্রীষ্ম',
    symptoms: ['ত্বক লাল হয়ে যাওয়া', 'চুলকানি', 'ব্যথা', 'ত্বক ফুলে যাওয়া'],
    details: 'গ্রীষ্মকালে অতিরিক্ত সূর্যের আলোতে থাকলে ত্বক পুড়ে যেতে পারে।',
    prevention: ['সানস্ক্রিন ব্যবহার করুন', 'সরাসরি সূর্যের আলো এড়িয়ে চলুন', 'হালকা রঙের কাপড় পরুন', 'ছাতা ব্যবহার করুন'],
    treatment: 'ঠান্ডা পানি দিয়ে ধুয়ে নিন, অ্যালোভেরা জেল লাগান, প্রচুর পানি পান করুন। যদি বেশি গুরুতর হয় তবে ডাক্তারের কাছে যান।',
    solution: 'সানবার্ন হলে প্রথমে ঠান্ডা পানি দিয়ে ধুয়ে নিন। অ্যালোভেরা জেল বা ক্যালামাইন লোশন লাগান। প্রচুর পানি পান করুন। যদি ফোস্কা হয় বা ব্যথা বেশি হয়, তবে ডাক্তারের কাছে যান।',
    tips: ['সানস্ক্রিন ব্যবহার করুন (SPF 30+)', 'সরাসরি সূর্যের আলো এড়িয়ে চলুন', 'হালকা রঙের ঢিলেঢালা কাপড় পরুন', 'ছাতা ব্যবহার করুন'],
    severity: 'হালকা',
    createdAt: new Date().toISOString()
  },
  {
    _id: '11',
    name: 'কনজাংটিভাইটিস',
    season: 'বর্ষা',
    symptoms: ['চোখ লাল হয়ে যাওয়া', 'চোখে চুলকানি', 'চোখ থেকে পানি পড়া', 'চোখে ব্যথা'],
    details: 'বর্ষাকালে ব্যাকটেরিয়া বা ভাইরাসের কারণে চোখের সংক্রমণ হতে পারে।',
    prevention: ['হাত ধোয়া অভ্যাস করুন', 'চোখে হাত দেবেন না', 'অন্যদের সাথে তোয়ালে শেয়ার করবেন না', 'পরিষ্কার থাকুন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, অ্যান্টিবায়োটিক ড্রপ ব্যবহার করতে হতে পারে। চোখে ঠান্ডা পানি দিয়ে ধুয়ে নিন।',
    solution: 'কনজাংটিভাইটিস হলে চোখে হাত দেবেন না। ঠান্ডা পানি দিয়ে চোখ ধুয়ে নিন। ডাক্তারের পরামর্শ অনুযায়ী অ্যান্টিবায়োটিক ড্রপ ব্যবহার করুন। অন্যদের সাথে তোয়ালে শেয়ার করবেন না।',
    tips: ['হাত ধোয়ার অভ্যাস করুন', 'চোখে হাত দেবেন না', 'চশমা পরুন', 'অন্যদের সাথে তোয়ালে শেয়ার করবেন না'],
    severity: 'হালকা',
    createdAt: new Date().toISOString()
  },
  {
    _id: '12',
    name: 'ফ্লু',
    season: 'শীত',
    symptoms: ['জ্বর', 'সর্দি', 'কাশি', 'গলাব্যথা', 'শরীরে ব্যথা', 'ক্লান্তি'],
    details: 'শীতকালে ইনফ্লুয়েঞ্জা ভাইরাসের কারণে ফ্লু হতে পারে।',
    prevention: ['টিকা নিন', 'হাত ধোয়া অভ্যাস করুন', 'অন্যদের সাথে কাছাকাছি থাকবেন না', 'গরম কাপড় পরুন'],
    treatment: 'বিশ্রাম নিন, প্রচুর পানি পান করুন, ভিটামিন সি খান। সাধারণত ৭-১০ দিনে সেরে যায়। জ্বর বেশি হলে ডাক্তারের কাছে যান।',
    solution: 'ফ্লু হলে পর্যাপ্ত বিশ্রাম নিন। প্রচুর পানি এবং তরল খাবার খান। ভিটামিন সি সমৃদ্ধ খাবার খান। জ্বরের জন্য প্যারাসিটামল নিন। সাধারণত ৭-১০ দিনে সেরে যায়।',
    tips: ['ফ্লু টিকা নিন', 'হাত ধোয়ার অভ্যাস করুন', 'অন্যের সাথে কাছাকাছি থাকবেন না', 'গরম কাপড় পরুন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '13',
    name: 'স্ক্যাবিস',
    season: 'শীত',
    symptoms: ['ত্বকে চুলকানি', 'লাল র্যাশ', 'ছোট ছোট ফোস্কা', 'রাতে বেশি চুলকানি'],
    details: 'শীতকালে পরিষ্কার-পরিচ্ছন্নতার অভাব হলে স্ক্যাবিস হতে পারে।',
    prevention: ['নিয়মিত গোসল করুন', 'পরিষ্কার কাপড় পরুন', 'অন্যদের সাথে কাপড় শেয়ার করবেন না', 'পরিষ্কার-পরিচ্ছন্ন থাকুন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, স্ক্যাবিস ওষুধ ব্যবহার করুন। সকল কাপড় গরম পানি দিয়ে ধুয়ে নিন।',
    solution: 'স্ক্যাবিস হলে ডাক্তারের পরামর্শ নিন। স্ক্যাবিস ওষুধ (পারমিথ্রিন ক্রিম) ব্যবহার করুন। সকল কাপড়, বিছানার চাদর গরম পানি দিয়ে ধুয়ে নিন। পরিবারের সদস্যদেরও চিকিৎসা নিতে হবে।',
    tips: ['নিয়মিত গোসল করুন', 'পরিষ্কার কাপড় পরুন', 'অন্যদের সাথে কাপড় শেয়ার করবেন না', 'বিছানার চাদর নিয়মিত পরিবর্তন করুন'],
    severity: 'হালকা',
    createdAt: new Date().toISOString()
  },
  {
    _id: '14',
    name: 'টাইফয়েড',
    season: 'বর্ষা',
    symptoms: ['জ্বর', 'পেটে ব্যথা', 'মাথাব্যথা', 'ক্ষুধা কমে যাওয়া', 'ডায়রিয়া'],
    details: 'দূষিত পানি বা খাবার খাওয়ার কারণে টাইফয়েড হতে পারে। বর্ষাকালে বেশি দেখা যায়।',
    prevention: ['পরিষ্কার পানি পান করুন', 'হাত ধোয়া অভ্যাস করুন', 'তাজা খাবার খান', 'টিকা নিন'],
    treatment: 'ডাক্তারের পরামর্শ নিন, অ্যান্টিবায়োটিক নিতে হবে। বিশ্রাম নিন এবং প্রচুর পানি পান করুন।',
    solution: 'টাইফয়েড হলে তাড়াতাড়ি ডাক্তারের কাছে যান। রক্ত পরীক্ষা করাতে হবে। অ্যান্টিবায়োটিক নিতে হবে এবং সম্পূর্ণ কোর্স শেষ করতে হবে। পর্যাপ্ত বিশ্রাম নিন এবং প্রচুর পানি পান করুন।',
    tips: ['পরিষ্কার পানি পান করুন', 'হাত ধোয়ার অভ্যাস করুন', 'টাইফয়েড টিকা নিন', 'তাজা রান্না করা খাবার খান'],
    severity: 'তীব্র',
    createdAt: new Date().toISOString()
  },
  {
    _id: '15',
    name: 'ইনফ্লুয়েঞ্জা',
    season: 'শীত',
    symptoms: ['তীব্র জ্বর', 'কাশি', 'গলাব্যথা', 'শরীরে ব্যথা', 'ক্লান্তি', 'মাথাব্যথা'],
    details: 'শীতকালে ইনফ্লুয়েঞ্জা ভাইরাসের কারণে এই রোগ হতে পারে।',
    prevention: ['টিকা নিন', 'হাত ধোয়া অভ্যাস করুন', 'অন্যদের থেকে দূরে থাকুন', 'গরম কাপড় পরুন'],
    treatment: 'বিশ্রাম নিন, প্রচুর পানি পান করুন, প্যারাসিটামল নিন। জ্বর বেশি হলে ডাক্তারের কাছে যান।',
    solution: 'ইনফ্লুয়েঞ্জা হলে পর্যাপ্ত বিশ্রাম নিন। প্রচুর পানি এবং তরল খাবার খান। জ্বরের জন্য প্যারাসিটামল নিন। যদি জ্বর বেশি হয় বা শ্বাসকষ্ট হয়, তবে ডাক্তারের কাছে যান।',
    tips: ['ইনফ্লুয়েঞ্জা টিকা নিন', 'হাত ধোয়ার অভ্যাস করুন', 'অন্যের থেকে দূরে থাকুন', 'গরম কাপড় পরুন'],
    severity: 'মাঝারি',
    createdAt: new Date().toISOString()
  },
  {
    _id: '16',
    name: 'চর্মরোগ',
    season: 'গ্রীষ্ম',
    symptoms: ['ত্বকে ফুসকুড়ি', 'চুলকানি', 'ত্বক লাল হয়ে যাওয়া', 'ঘামাচি'],
    details: 'গ্রীষ্মকালে অতিরিক্ত ঘাম এবং গরমে চর্মরোগ হতে পারে।',
    prevention: ['নিয়মিত গোসল করুন', 'শুকনো কাপড় পরুন', 'ত্বক পরিষ্কার রাখুন', 'প্রচুর পানি পান করুন'],
    treatment: 'ত্বক পরিষ্কার রাখুন, ঠান্ডা পানি দিয়ে ধুয়ে নিন। চুলকানি হলে ডাক্তারের পরামর্শ নিন।',
    solution: 'চর্মরোগ হলে ত্বক পরিষ্কার রাখুন। নিয়মিত গোসল করুন এবং ঠান্ডা পানি ব্যবহার করুন। শুকনো কাপড় পরুন। যদি চুলকানি বেশি হয়, তবে ডাক্তারের পরামর্শ নিন।',
    tips: ['নিয়মিত গোসল করুন', 'শুকনো কাপড় পরুন', 'ত্বক পরিষ্কার রাখুন', 'প্রচুর পানি পান করুন'],
    severity: 'হালকা',
    createdAt: new Date().toISOString()
  }
];

export async function getAllDiseases(req, res, next) {
  try {
    if (useMemory) {
      return res.json(memoryDiseases);
    }
    const diseases = await SeasonalDisease.find().sort({ season: 1, name: 1 });
    res.json(diseases);
  } catch (err) { next(err); }
}

export async function getDiseaseById(req, res, next) {
  try {
    const { id } = req.params;
    if (useMemory) {
      const disease = memoryDiseases.find(d => d._id === id);
      if (!disease) return res.status(404).json({ message: 'রোগ পাওয়া যায়নি' });
      return res.json(disease);
    }
    const disease = await SeasonalDisease.findById(id);
    if (!disease) return res.status(404).json({ message: 'রোগ পাওয়া যায়নি' });
    res.json(disease);
  } catch (err) { next(err); }
}

export async function getDiseasesBySeason(req, res, next) {
  try {
    const { season } = req.params;
    if (useMemory) {
      const diseases = memoryDiseases.filter(d => d.season === season || d.season === 'সবসময়');
      return res.json(diseases);
    }
    const diseases = await SeasonalDisease.find({
      $or: [{ season }, { season: 'সবসময়' }]
    }).sort({ name: 1 });
    res.json(diseases);
  } catch (err) { next(err); }
}

export async function createDisease(req, res, next) {
  try {
    const { name, season, symptoms, details, prevention, treatment, severity } = req.body;
    if (!name || !season || !details || !treatment) {
      return res.status(400).json({ message: 'name, season, details, treatment প্রয়োজন' });
    }
    if (useMemory) {
      const disease = {
        _id: `${Date.now()}-${Math.random()}`,
        name,
        season,
        symptoms: symptoms || [],
        details,
        prevention: prevention || [],
        treatment,
        severity: severity || 'মাঝারি',
        createdAt: new Date().toISOString()
      };
      memoryDiseases.push(disease);
      return res.status(201).json(disease);
    }
    const disease = await SeasonalDisease.create({
      name,
      season,
      symptoms: symptoms || [],
      details,
      prevention: prevention || [],
      treatment,
      severity: severity || 'মাঝারি'
    });
    res.status(201).json(disease);
  } catch (err) { next(err); }
}

